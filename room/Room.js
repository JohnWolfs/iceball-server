"use strict";
var Game_1 = require('../Game');
var ScoreHelper_1 = require('./ScoreHelper');
var Room = (function () {
    function Room(rid, user1, user2) {
        this._readyList = [];
        this.status = 1;
        this._rid = rid;
        this._userList = [user1, user2];
        this._socketList = [user1.socket, user2.socket];
        this._userList[0].rid = this._rid;
        this._userList[1].rid = this._rid;
        this._socketList[0].join(this._rid);
        this._socketList[1].join(this._rid);
        this._scoreHelper = new ScoreHelper_1.default(user1.uid, user1.name, user2.uid, user2.name);
        var direction = Math.random() < 0.5 ? 0 : 1;
        this._socketList[0].emit('room:created', { opponent: user2.name, ballDirection: direction });
        this._socketList[1].emit('room:created', { opponent: user1.name, ballDirection: 1 - direction });
        console.log('System:  create room for [' + this._userList[0].uid + ' and ' + this._userList[1].uid + ']');
        console.log('<=== emit room:created to [' + this._userList[0].uid + ' and ' + this._userList[1].uid + ']');
    }
    Object.defineProperty(Room.prototype, "rid", {
        get: function () {
            return this._rid;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Room.prototype, "game", {
        get: function () {
            return this._game;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Room.prototype, "scoreHelper", {
        get: function () {
            return this._scoreHelper;
        },
        enumerable: true,
        configurable: true
    });
    Room.prototype.getReady = function (uid) {
        this._readyList.push(uid);
        if (this._readyList.length === 2) {
            this._game = new Game_1.default(this._rid, this._userList);
            this._game.start();
            this._readyList = [];
        }
    };
    Room.prototype.stopGame = function () {
        this.status = 0;
        if (this._game)
            this._game.stop();
    };
    Room.prototype.destroy = function () {
        this.stopGame();
        if (this._socketList[0])
            this._socketList[0].leave(this._rid);
        if (this._socketList[1])
            this._socketList[1].leave(this._rid);
    };
    Room.prototype.isObjectValueEqual = function (a, b) {
        var aProps = Object.getOwnPropertyNames(a);
        var bProps = Object.getOwnPropertyNames(b);
        if (aProps.length != bProps.length) {
            return false;
        }
        for (var i = 0; i < aProps.length; i++) {
            var propName = aProps[i];
            if (a[propName] !== b[propName]) {
                return false;
            }
        }
        return true;
    };
    return Room;
}());
Object.defineProperty(exports, "__esModule", { value: true });
exports.default = Room;

//# sourceMappingURL=data:application/json;base64,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QUM7WUFDakMsTUFBTSxDQUFDLEtBQUssQ0FBQztRQUNqQixDQUFDO1FBRUQsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxNQUFNLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7WUFDckMsSUFBSSxRQUFRLEdBQUcsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBRXpCLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUM5QixNQUFNLENBQUMsS0FBSyxDQUFDO1lBQ2pCLENBQUM7UUFDTCxDQUFDO1FBRUQsTUFBTSxDQUFDLElBQUksQ0FBQztJQUNoQixDQUFDO0lBQ0wsV0FBQztBQUFELENBdkdBLEFBdUdDLElBQUE7QUF2R0Q7c0JBdUdDLENBQUEiLCJmaWxlIjoicm9vbS9Sb29tLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFVzZXIgZnJvbSAnLi4vdXNlci9Vc2VyJztcclxuaW1wb3J0IEdhbWUgZnJvbSAnLi4vR2FtZSc7XHJcbmltcG9ydCBTY29yZUhlbHBlciBmcm9tICcuL1Njb3JlSGVscGVyJztcclxuaW1wb3J0IFJvb21NYW5hZ2VyIGZyb20gJy4vUm9vbU1hbmFnZXInO1xyXG5pbXBvcnQgVXNlck1hbmFnZXIgZnJvbSAnLi4vdXNlci9Vc2VyTWFuYWdlcic7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBSb29tIHtcclxuICAgIHByaXZhdGUgX3JpZDpzdHJpbmc7XHJcbiAgICBwcml2YXRlIF91c2VyTGlzdDogQXJyYXk8VXNlcj47XHJcbiAgICBwcml2YXRlIF9zb2NrZXRMaXN0OiBBcnJheTxTb2NrZXRJTy5Tb2NrZXQ+O1xyXG4gICAgcHJpdmF0ZSBfcmVhZHlMaXN0OiBBcnJheTxzdHJpbmc+ID0gW107XHJcbiAgICBwcml2YXRlIF9zY29yZUhlbHBlcjogU2NvcmVIZWxwZXI7XHJcbiAgICBwcml2YXRlIF9nYW1lOiBHYW1lO1xyXG4gICAgLy8g5oi/6Ze054q25oCB5YC877yMIDHvvJrmraPluLjov5DooYznirbmgIEgMO+8muiHs+WwkeacieS4gOS4queOqeWutuaWree6v++8jOaIv+mXtOWBnOatoueKtuaAgVxyXG4gICAgcHVibGljIHN0YXR1czogbnVtYmVyID0gMTtcclxuICAgIFxyXG4gICAgY29uc3RydWN0b3IocmlkOnN0cmluZywgdXNlcjE6VXNlciwgdXNlcjI6VXNlcikge1xyXG5cclxuICAgICAgICAvLyDliJ3lp4vljJbmiL/pl7Tlj7fjgIHnlKjmiLfpmJ/liJfjgIHnq6/lj6PpmJ/liJdcclxuICAgICAgICB0aGlzLl9yaWQgPSByaWQ7XHJcbiAgICAgICAgdGhpcy5fdXNlckxpc3QgPSBbdXNlcjEsIHVzZXIyXTtcclxuICAgICAgICB0aGlzLl9zb2NrZXRMaXN0ID0gW3VzZXIxLnNvY2tldCwgdXNlcjIuc29ja2V0XTtcclxuICAgICAgICBcclxuICAgICAgICB0aGlzLl91c2VyTGlzdFswXS5yaWQgPSB0aGlzLl9yaWQ7XHJcbiAgICAgICAgdGhpcy5fdXNlckxpc3RbMV0ucmlkID0gdGhpcy5fcmlkO1xyXG4gICAgICAgIHRoaXMuX3NvY2tldExpc3RbMF0uam9pbih0aGlzLl9yaWQpO1xyXG4gICAgICAgIHRoaXMuX3NvY2tldExpc3RbMV0uam9pbih0aGlzLl9yaWQpO1xyXG5cclxuICAgICAgICAvLyDliJ3lp4vljJbliIbmlbDnrqHnkIblmahcclxuICAgICAgICB0aGlzLl9zY29yZUhlbHBlciA9IG5ldyBTY29yZUhlbHBlcih1c2VyMS51aWQsIHVzZXIxLm5hbWUsIHVzZXIyLnVpZCwgdXNlcjIubmFtZSk7XHJcblxyXG4gICAgICAgIC8vIOmaj+acuuaWueWQkVxyXG4gICAgICAgIGxldCBkaXJlY3Rpb24gPSBNYXRoLnJhbmRvbSgpIDwgMC41PyAwIDogMTtcclxuXHJcbiAgICAgICAgLy8g5oi/6Ze05Yib5bu65oiQ5Yqf77yM5Y+R6YCB5raI5oGv5Yiw5a6i5oi356uvXHJcbiAgICAgICAgLy8g5Yid5aeL5YyW5q+U6LWb55CD55qE5Yid5aeL5pa55ZCR77yM5Y+R6YCB55CD5Yid5aeL5YyW5raI5oGvXHJcbiAgICAgICAgdGhpcy5fc29ja2V0TGlzdFswXS5lbWl0KCdyb29tOmNyZWF0ZWQnLCB7b3Bwb25lbnQ6IHVzZXIyLm5hbWUsIGJhbGxEaXJlY3Rpb246IGRpcmVjdGlvbn0pO1xyXG4gICAgICAgIHRoaXMuX3NvY2tldExpc3RbMV0uZW1pdCgncm9vbTpjcmVhdGVkJywge29wcG9uZW50OiB1c2VyMS5uYW1lLCBiYWxsRGlyZWN0aW9uOiAxIC0gZGlyZWN0aW9ufSk7XHJcblxyXG4gICAgICAgIGNvbnNvbGUubG9nKCdTeXN0ZW06ICBjcmVhdGUgcm9vbSBmb3IgWycgKyB0aGlzLl91c2VyTGlzdFswXS51aWQgKyAnIGFuZCAnICsgdGhpcy5fdXNlckxpc3RbMV0udWlkICsgJ10nKTtcclxuICAgICAgICBjb25zb2xlLmxvZygnPD09PSBlbWl0IHJvb206Y3JlYXRlZCB0byBbJyArIHRoaXMuX3VzZXJMaXN0WzBdLnVpZCArICcgYW5kICcgKyB0aGlzLl91c2VyTGlzdFsxXS51aWQgKyAnXScpO1xyXG5cclxuICAgICAgICAvLyBjb25zb2xlLmxvZyhVc2VyTWFuYWdlci5JbnN0YW5jZS51c2VyTGlzdC5sZW5ndGgpO1xyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKFJvb21NYW5hZ2VyLkluc3RhbmNlLnJvb21MaXN0Lmxlbmd0aCk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHJpZCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fcmlkO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBnYW1lKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9nYW1lO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBzY29yZUhlbHBlcigpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fc2NvcmVIZWxwZXI7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8qKlxyXG4gICAgICog5LiA5Liq55So5oi35YeG5aSHXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBnZXRSZWFkeSh1aWQ6IHN0cmluZykge1xyXG4gICAgICAgIHRoaXMuX3JlYWR5TGlzdC5wdXNoKHVpZCk7XHJcbiAgICAgICAgaWYodGhpcy5fcmVhZHlMaXN0Lmxlbmd0aCA9PT0gMikgeyAgIFxyXG5cclxuICAgICAgICAgICAgLy8g5Y+M5pa5546p5a625YeG5aSH5bCx57uq77yMIOWIneWni+WMlua4uOaIj+WunuS+i1xyXG4gICAgICAgICAgICB0aGlzLl9nYW1lID0gbmV3IEdhbWUodGhpcy5fcmlkLCB0aGlzLl91c2VyTGlzdCk7XHJcbiAgICAgICAgICAgIHRoaXMuX2dhbWUuc3RhcnQoKTtcclxuXHJcbiAgICAgICAgICAgIC8vIOa4heepuuWHhuWkh+mYn+WIl1xyXG4gICAgICAgICAgICB0aGlzLl9yZWFkeUxpc3QgPSBbXTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDlgZzmraLmuLjmiI9cclxuICAgICAqL1xyXG4gICAgcHVibGljIHN0b3BHYW1lKCkge1xyXG4gICAgICAgIHRoaXMuc3RhdHVzID0gMDtcclxuICAgICAgICBpZih0aGlzLl9nYW1lKSB0aGlzLl9nYW1lLnN0b3AoKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyDmuIXnkIbmiL/pl7TmlbDmja5cclxuICAgIHB1YmxpYyBkZXN0cm95KCkge1xyXG4gICAgICAgIHRoaXMuc3RvcEdhbWUoKTtcclxuICAgICAgICBcclxuICAgICAgICBpZih0aGlzLl9zb2NrZXRMaXN0WzBdKSB0aGlzLl9zb2NrZXRMaXN0WzBdLmxlYXZlKHRoaXMuX3JpZCk7XHJcbiAgICAgICAgaWYodGhpcy5fc29ja2V0TGlzdFsxXSkgdGhpcy5fc29ja2V0TGlzdFsxXS5sZWF2ZSh0aGlzLl9yaWQpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOWIpOaWreS4pOS4quWvueixoeaYr+WQpuWAvOebuOetiVxyXG4gICAgcHJpdmF0ZSBpc09iamVjdFZhbHVlRXF1YWwoYTogT2JqZWN0LCBiOiBPYmplY3QpIHtcclxuICAgICAgICB2YXIgYVByb3BzID0gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoYSk7XHJcbiAgICAgICAgdmFyIGJQcm9wcyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKGIpO1xyXG4gXHJcbiAgICAgICAgaWYgKGFQcm9wcy5sZW5ndGggIT0gYlByb3BzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhUHJvcHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgdmFyIHByb3BOYW1lID0gYVByb3BzW2ldO1xyXG5cclxuICAgICAgICAgICAgaWYgKGFbcHJvcE5hbWVdICE9PSBiW3Byb3BOYW1lXSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxufSJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
